var G=Object.defineProperty;var K=(n,c,s)=>c in n?G(n,c,{enumerable:!0,configurable:!0,writable:!0,value:s}):n[c]=s;var F=(n,c,s)=>K(n,typeof c!="symbol"?c+"":c,s);import{r as e,T as B,a as I,j as r,b as $,M as V,N as Y,G as q,S as X,L as z,c as J,C as Q,e as ee,h as te,i as re,k as H,m as se,l as oe,s as ne,t as ae}from"./styles-C-u7fvf6.js";const ie=e.forwardRef(function({locations:c,onBoundsChange:s,viewState:C,onMove:d,selectedLocation:m,onLocationClick:l,padding:h,onMapLoad:M,onMoveEnd:v,mapboxToken:T,mapboxStyle:S},b){const x=e.useRef(null);e.useImperativeHandle(b,()=>({flyTo:i=>{var f;const u=(f=x.current)==null?void 0:f.getMap();u&&u.flyTo({center:i.center,zoom:i.zoom??I,duration:B})}}),[]);const j=e.useCallback(()=>{const i=x.current;if(i){const u=i.getMap().getBounds();s(u)}},[s]),E=e.useCallback(()=>{j(),v&&v()},[j,v]),t=e.useCallback(i=>{d(i)},[d]),a=e.useMemo(()=>({type:"FeatureCollection",features:c.map(i=>({...i,id:i.properties.id}))}),[c]),o=e.useCallback(i=>{var P,k;const u=i.features||[],f=(k=(P=u[0])==null?void 0:P.properties)==null?void 0:k.cluster_id,N=x.current;if(f&&N){const w=N.getSource("ppr-locations");w&&w.getClusterExpansionZoom(f,(D,p)=>{var y,_;if(D||p==null)return;const g=(y=u[0])==null?void 0:y.geometry,R=g&&"coordinates"in g&&Array.isArray(g.coordinates)?g.coordinates:void 0;if(!R)return;const W=(_=x.current)==null?void 0:_.getMap();W&&W.flyTo({center:[R[0],R[1]],zoom:p,duration:B})})}},[]),A=e.useCallback(i=>{var f,N,P;if(!c.length)return;const u=(f=i.features)==null?void 0:f[0];if(u&&typeof((N=u.properties)==null?void 0:N.id)=="string"){const k=c.find(w=>{var D;return w.properties.id===((D=u.properties)==null?void 0:D.id)});if(k){l(k);const w=(P=x.current)==null?void 0:P.getMap();w&&w.flyTo({center:[k.geometry.coordinates[0],k.geometry.coordinates[1]],zoom:I,duration:B})}}},[c,l]),L=e.useCallback(i=>{var u,f;(u=i.features)!=null&&u.length&&((f=i.features[0].properties)!=null&&f.cluster?o(i):A(i))},[o,A]);return r.jsxs($,{ref:x,mapboxAccessToken:T,mapStyle:S,maxZoom:I,minZoom:V,reuseMaps:!0,cooperativeGestures:!0,dragRotate:!1,style:{width:"100%",height:"100%"},...C,onMove:t,onMoveEnd:E,padding:h,onLoad:M,interactiveLayerIds:["clusters","cluster-count","unclustered-point"],onClick:L,children:[r.jsx(Y,{position:"top-right",showCompass:!1}),r.jsx(q,{position:"top-right"}),r.jsxs(X,{id:"ppr-locations",type:"geojson",data:a,cluster:!0,clusterMaxZoom:I-2,clusterRadius:100,children:[r.jsx(z,{id:"clusters",type:"circle",filter:["all",["has","point_count"],[">=",["get","point_count"],4]],paint:{"circle-color":"#0B4778","circle-radius":["step",["get","point_count"],20,10,30,50,40]}}),r.jsx(z,{id:"small-clusters",type:"circle",filter:["all",["has","point_count"],["<",["get","point_count"],4]],paint:{"circle-color":"#0B4778","circle-radius":18}}),r.jsx(z,{id:"cluster-count",type:"symbol",filter:["has","point_count"],layout:{"text-field":"{point_count_abbreviated}","text-font":["DIN Offc Pro Medium","Arial Unicode MS Bold"],"text-size":14},paint:{"text-color":"#ffffff"}}),r.jsx(z,{id:"unclustered-point",type:"circle",filter:m?["all",["!",["has","point_count"]],["!=",["get","id"],m.properties.id]]:["!",["has","point_count"]],paint:{"circle-color":"#6fbab3","circle-radius":10}})]}),m&&r.jsx(J,{longitude:m.geometry.coordinates[0],latitude:m.geometry.coordinates[1],children:r.jsx("div",{className:"w-4 h-4 rounded-full border-2 border-white shadow-md bg-[#0B4778]",style:{transform:"translate(-50%, -50%)"}})},m.properties.id)]})}),U=e.forwardRef(({location:n,isSelected:c,onClick:s,className:C,...d},m)=>{const l=n.properties;return r.jsxs(Q,{ref:m,className:ee("ppr-location-card pb-4 cursor-pointer md:w-auto w-64 flex-shrink-0 min-h-[180px] transition-all duration-200 ease-out border-2 border-gray-200 relative hover:bg-[#E1F3F8] hover:shadow-md","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]",c&&"bg-[#E1F3F8] border-[#B5D7DD] shadow-xl z-10 transform -translate-y-3 md:translate-x-3 md:translate-y-0",C),onClick:()=>s(n),onKeyDown:h=>{(h.key==="Enter"||h.key===" ")&&(h.preventDefault(),s(n))},role:"listitem",...d,children:[r.jsxs(te,{children:[r.jsx(re,{children:l.name}),r.jsx(H,{className:"sr-only",children:"PPR Location"}),l.address&&r.jsxs(H,{className:"flex items-start gap-2",children:[r.jsx(se,{width:16,height:16,className:"fill-current text-accent flex-shrink-0 mt-0.5"}),r.jsx("span",{className:"line-clamp-2",children:l.address})]})]}),r.jsxs(oe,{className:"space-y-2",children:[l.recruiterName&&r.jsx("p",{className:"text-sm md:text-base font-medium text-gray-700",children:l.recruiterName}),l.recruiterEmail&&r.jsx("a",{href:`mailto:${l.recruiterEmail}`,className:"text-sm md:text-base text-primary hover:underline block truncate",onClick:h=>h.stopPropagation(),children:l.recruiterEmail}),l.recruiterPhone&&r.jsx("a",{href:`tel:${l.recruiterPhone.replace(/\D/g,"")}`,className:"text-sm md:text-base text-primary hover:underline block",onClick:h=>h.stopPropagation(),children:l.recruiterPhone})]})]})});U.displayName="PprLocationCard";const O=50;function le({locations:n,onLocationClick:c,selectedLocation:s,resetScrollSignal:C=0}){const d=e.useRef(null),m=e.useRef({}),l=e.useRef([]),h=e.useRef(null),[M,v]=e.useState(O),[T,S]=e.useState(0),b=e.useMemo(()=>n.slice(0,M),[n,M]),x=n.length>b.length,j=e.useCallback(()=>{x&&v(t=>Math.min(t+O,n.length))},[x,n.length]);e.useEffect(()=>{if(s){const t=n.findIndex(a=>a.properties.id===s.properties.id);t>=0&&t>=M&&v(Math.min(t+O,n.length))}},[s,n,M]),e.useEffect(()=>{const t=h.current;if(!t)return;const a=new IntersectionObserver(o=>{o[0].isIntersecting&&x&&j()},{threshold:.1,rootMargin:"100px"});return a.observe(t),()=>a.disconnect()},[x,j]),e.useEffect(()=>{v(O),S(0),m.current={},l.current=[]},[n]),e.useEffect(()=>{d.current&&(window.innerWidth<768?d.current.scrollLeft=0:d.current.scrollTop=0)},[C]),e.useEffect(()=>{if(s){const t=b.findIndex(a=>a.properties.id===s.properties.id);t!==-1&&S(t)}},[s,b]),e.useEffect(()=>{if(!s||!d.current)return;const t=m.current[s.properties.id];t&&requestAnimationFrame(()=>{const a=d.current;if(!(!a||!t))if(window.innerWidth<768){const o=t.offsetLeft-(a.clientWidth-t.clientWidth)/2;a.scrollTo({left:Math.max(0,o),behavior:"smooth"})}else{const o=t.offsetTop-(a.clientHeight-t.clientHeight)/2;a.scrollTo({top:Math.max(0,o),behavior:"smooth"})}})},[s,b]);const E=e.useCallback(t=>{var A;if(t.target.getAttribute("role")!=="listitem"||t.key!=="ArrowUp"&&t.key!=="ArrowDown"&&t.key!=="ArrowLeft"&&t.key!=="ArrowRight")return;t.preventDefault();const a=window.innerWidth>=768;let o=T;a?t.key==="ArrowDown"?o++:t.key==="ArrowUp"&&o--:t.key==="ArrowRight"?o++:t.key==="ArrowLeft"&&o--,o>=0&&o<b.length&&(S(o),(A=l.current[o])==null||A.focus())},[T,b.length]);return e.useEffect(()=>{const t=d.current;if(!t)return;const a=o=>{window.innerWidth<768&&o.deltaY!==0?(o.preventDefault(),t.scrollLeft+=o.deltaY):o.stopPropagation()};return t.addEventListener("wheel",a,{passive:!1}),()=>t.removeEventListener("wheel",a)},[]),r.jsxs("div",{className:"md:overflow-y-auto overflow-x-auto md:max-h-screen max-w-full h-full flex md:flex-col flex-row hide-scrollbar gap-2 md:p-4 p-2 pt-4",ref:d,onKeyDown:E,role:"list","aria-label":"PPR locations",tabIndex:-1,children:[b.map((t,a)=>r.jsx(U,{ref:o=>{m.current[t.properties.id]=o,l.current[a]=o},location:t,isSelected:(s==null?void 0:s.properties.id)===t.properties.id,onClick:c,tabIndex:a===T?0:-1,"aria-posinset":a+1,"aria-setsize":n.length},t.properties.id)),x&&r.jsxs("div",{ref:h,className:"md:w-auto w-64 flex-shrink-0 min-h-[180px] flex items-center justify-center text-sm text-gray-500 p-4",children:["Showing ",b.length," of ",n.length]})]})}const ce=320,de=400,ue={longitude:-98.5795,latitude:39.8283,zoom:3.5,transitionDuration:B};function fe({geojsonUrl:n,mapboxToken:c,mapboxStyle:s,container:C}){const[d,m]=e.useState(null),[l,h]=e.useState(null),[M,v]=e.useState(ue),[T,S]=e.useState({left:0,top:0,right:0,bottom:0}),[b,x]=e.useState(!0),[j,E]=e.useState(!0),[t,a]=e.useState(null),[o]=e.useState(0),[A,L]=e.useState(!1),i=e.useRef(null),u=e.useRef(null);e.useEffect(()=>{const p=()=>{const R=window.innerWidth<768;S(R?{left:0,top:0,right:0,bottom:ce}:{left:de,top:0,right:0,bottom:0})},g=()=>{i.current&&clearTimeout(i.current),i.current=setTimeout(p,150)};return p(),window.addEventListener("resize",g),()=>{window.removeEventListener("resize",g),i.current&&clearTimeout(i.current)}},[]),e.useEffect(()=>{let p=!0;const g=new AbortController,R=n||"";return(async()=>{if(!R){E(!1);return}try{E(!0),a(null);const y=await fetch(R,{signal:g.signal,headers:{Accept:"application/geo+json, application/json"}});if(!y.ok)throw new Error(`Failed to fetch: ${y.status} ${y.statusText}`);const _=await y.json();p&&(m(_),E(!1))}catch(y){p&&!g.signal.aborted&&(a(y instanceof Error?y.message:"Failed to load PPR locations"),E(!1))}})(),()=>{p=!1,g.abort()}},[n]);const f=(d==null?void 0:d.features)??[],N=e.useCallback(()=>L(!0),[]),P=e.useCallback(()=>L(!1),[]),k=e.useCallback(p=>{},[A]),w=e.useCallback(p=>{var g;h(p),N(),(g=u.current)==null||g.flyTo({center:[p.geometry.coordinates[0],p.geometry.coordinates[1]],zoom:I})},[N]),D=e.useCallback(()=>{P()},[P]);return t&&!j?r.jsx("div",{className:"w-full h-screen flex items-center justify-center bg-gray-50",children:r.jsxs("div",{className:"max-w-md p-8 bg-white rounded-lg shadow-lg text-center",children:[r.jsx("div",{className:"text-red-500 mb-4",children:r.jsx("svg",{className:"w-16 h-16 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),r.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Unable to Load PPR Locations"}),r.jsx("p",{className:"text-gray-600 mb-6",children:t})]})}):r.jsx("div",{className:"w-full h-full overflow-hidden flex flex-col min-w-[340px] relative",children:r.jsxs("div",{className:"relative flex-1 w-full h-0 min-h-0 overflow-hidden z-10",children:[r.jsxs("div",{className:"absolute z-10 md:top-0 md:left-0 md:bottom-0 md:w-[400px] md:h-full w-full h-[320px] bottom-0 left-0 pointer-events-auto",children:[r.jsxs("div",{className:"text-sm md:text-base font-bold mt-4 mx-2 mb-2 md:mb-0","aria-live":"polite",children:[f.length," PPR Location",f.length===1?"":"s"]}),r.jsx(le,{locations:f,onLocationClick:w,selectedLocation:l,resetScrollSignal:o})]}),r.jsxs("div",{className:"absolute inset-0 z-0",children:[r.jsx(ie,{ref:u,locations:f,onBoundsChange:k,viewState:M,onMove:p=>v(p.viewState),selectedLocation:l,onLocationClick:w,padding:T,onMapLoad:()=>x(!1),onMoveEnd:D,mapboxToken:c||"",mapboxStyle:s||"mapbox://styles/mapbox/streets-v11"}),(b||j)&&r.jsxs("div",{className:"absolute inset-0 flex items-center justify-center bg-white bg-opacity-70 z-50",children:[r.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-4 border-brand-blue border-solid"}),r.jsx("span",{className:"ml-4 text-lg font-semibold text-brand-blue",children:j?"Loading PPR locations…":"Loading map…"})]})]})]})})}const Z=new CSSStyleSheet;Z.replaceSync(ne.replace(/:root/ug,":host"));class pe extends HTMLElement{constructor(){super();F(this,"root",null);F(this,"container",null);this.attachShadow({mode:"open",delegatesFocus:!0})}static get observedAttributes(){return["geojson-url","mapbox-token","mapbox-style"]}getProps(){return{geojsonUrl:this.getAttribute("geojson-url")||void 0,mapboxToken:this.getAttribute("mapbox-token")||void 0,mapboxStyle:this.getAttribute("mapbox-style")||void 0,container:this.container}}connectedCallback(){this.render()}disconnectedCallback(){var s;(s=this.root)==null||s.unmount(),this.root=null}attributeChangedCallback(s,C,d){C!==d&&this.root&&this.render()}render(){var s;this.shadowRoot&&((s=this.root)==null||s.unmount(),this.root=null,this.shadowRoot.adoptedStyleSheets=[Z],this.shadowRoot.innerHTML="",this.container=document.createElement("div"),this.container.className="mount-point",this.shadowRoot.appendChild(this.container),this.root=ae.createRoot(this.container),this.root.render(r.jsx(e.StrictMode,{children:r.jsx(fe,{...this.getProps()})})))}}customElements.define("ppr-locations-map",pe);
