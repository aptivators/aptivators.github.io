var K=Object.defineProperty;var $=(s,d,n)=>d in s?K(s,d,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[d]=n;var H=(s,d,n)=>$(s,typeof d!="symbol"?d+"":d,n);import{r as e,T as F,a as _,j as t,b as q,M as Q,N as Y,G as X,S as J,L as O,c as ee,C as te,e as re,h as se,i as ne,k as oe,l as ae,m as ie,I as le,q as ce,t as de,u as ue}from"./styles-Cn-bjl8v.js";const pe=e.forwardRef(function({locations:d,onBoundsChange:n,viewState:S,onMove:u,selectedLocation:m,onLocationClick:l,padding:v,onMapLoad:C,onMoveEnd:k,mapboxToken:R,mapboxStyle:E},b){const f=e.useRef(null);e.useImperativeHandle(b,()=>({flyTo:i=>{var h;const p=(h=f.current)==null?void 0:h.getMap();p&&p.flyTo({center:i.center,zoom:i.zoom??_,duration:F})}}),[]);const M=e.useCallback(()=>{const i=f.current;if(i){const p=i.getMap().getBounds();n(p)}},[n]),P=e.useCallback(()=>{M(),k&&k()},[M,k]),r=e.useCallback(i=>{u(i)},[u]),a=e.useMemo(()=>({type:"FeatureCollection",features:d.map(i=>({...i,id:i.properties.id}))}),[d]),o=e.useCallback(i=>{var A,x;const p=i.features||[],h=(x=(A=p[0])==null?void 0:A.properties)==null?void 0:x.cluster_id,y=f.current;if(h&&y){const j=y.getSource("ppr-locations");j&&j.getClusterExpansionZoom(h,(L,B)=>{var g,w;if(L||B==null)return;const I=(g=p[0])==null?void 0:g.geometry,D=I&&"coordinates"in I&&Array.isArray(I.coordinates)?I.coordinates:void 0;if(!D)return;const c=(w=f.current)==null?void 0:w.getMap();c&&c.flyTo({center:[D[0],D[1]],zoom:B,duration:F})})}},[]),T=e.useCallback(i=>{var h,y,A;if(!d.length)return;const p=(h=i.features)==null?void 0:h[0];if(p&&typeof((y=p.properties)==null?void 0:y.id)=="string"){const x=d.find(j=>{var L;return j.properties.id===((L=p.properties)==null?void 0:L.id)});if(x){l(x);const j=(A=f.current)==null?void 0:A.getMap();j&&j.flyTo({center:[x.geometry.coordinates[0],x.geometry.coordinates[1]],zoom:_,duration:F})}}},[d,l]),z=e.useCallback(i=>{var p,h;(p=i.features)!=null&&p.length&&((h=i.features[0].properties)!=null&&h.cluster?o(i):T(i))},[o,T]);return t.jsxs(q,{ref:f,mapboxAccessToken:R,mapStyle:E,maxZoom:_,minZoom:Q,reuseMaps:!0,cooperativeGestures:!0,dragRotate:!1,style:{width:"100%",height:"100%"},...S,onMove:r,onMoveEnd:P,padding:v,onLoad:C,interactiveLayerIds:["clusters","cluster-count","unclustered-point"],onClick:z,children:[t.jsx(Y,{position:"top-right",showCompass:!1}),t.jsx(X,{position:"top-right"}),t.jsxs(J,{id:"ppr-locations",type:"geojson",data:a,cluster:!0,clusterMaxZoom:_-2,clusterRadius:100,children:[t.jsx(O,{id:"clusters",type:"circle",filter:["all",["has","point_count"],[">=",["get","point_count"],4]],paint:{"circle-color":"#0B4778","circle-radius":["step",["get","point_count"],20,10,30,50,40]}}),t.jsx(O,{id:"small-clusters",type:"circle",filter:["all",["has","point_count"],["<",["get","point_count"],4]],paint:{"circle-color":"#0B4778","circle-radius":18}}),t.jsx(O,{id:"cluster-count",type:"symbol",filter:["has","point_count"],layout:{"text-field":"{point_count_abbreviated}","text-font":["DIN Offc Pro Medium","Arial Unicode MS Bold"],"text-size":14},paint:{"text-color":"#ffffff"}}),t.jsx(O,{id:"unclustered-point",type:"circle",filter:m?["all",["!",["has","point_count"]],["!=",["get","id"],m.properties.id]]:["!",["has","point_count"]],paint:{"circle-color":"#6fbab3","circle-radius":10}})]}),m&&t.jsx(ee,{longitude:m.geometry.coordinates[0],latitude:m.geometry.coordinates[1],children:t.jsx("div",{className:"w-4 h-4 rounded-full border-2 border-white shadow-md bg-[#0B4778]",style:{transform:"translate(-50%, -50%)"}})},m.properties.id)]})}),he=s=>e.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",...s},e.createElement("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"})),me=s=>e.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",...s},e.createElement("path",{d:"M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4-8 5-8-5V6l8 5 8-5v2z"})),fe=s=>e.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",...s},e.createElement("path",{d:"M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z"})),U=e.forwardRef(({location:s,isSelected:d,onClick:n,className:S,...u},m)=>{const l=s.properties;return t.jsxs(te,{ref:m,className:re("ppr-location-card pb-4 cursor-pointer md:w-auto w-64 flex-shrink-0 min-h-[180px] transition-all duration-200 ease-out border-2 border-gray-200 relative hover:bg-[#E1F3F8] hover:shadow-md","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]",d&&"bg-[#E1F3F8] border-[#B5D7DD] shadow-xl z-10 transform -translate-y-3 md:translate-x-3 md:translate-y-0",S),onClick:()=>n(s),onKeyDown:v=>{(v.key==="Enter"||v.key===" ")&&(v.preventDefault(),n(s))},role:"listitem",...u,children:[t.jsxs(se,{className:"pb-0",children:[t.jsx(ne,{className:"text-lg leading-tight",children:l.name}),t.jsx(oe,{className:"sr-only",children:"PPR Location"})]}),t.jsxs(ae,{className:"space-y-2",children:[l.address&&t.jsxs("div",{className:"text-sm flex items-center gap-2",children:[t.jsx(ie,{width:16,height:16,className:"fill-current text-accent flex-shrink-0"}),t.jsx("span",{className:"line-clamp-2 text-pretty whitespace-pre-wrap",children:l.address})]}),l.recruiterName&&t.jsxs("div",{className:"text-sm flex items-center gap-2",children:[t.jsx(he,{width:16,height:16,className:"fill-current text-accent flex-shrink-0"}),t.jsx("span",{className:"line-clamp-2",children:l.recruiterName})]}),l.recruiterEmail&&t.jsxs("a",{href:`mailto:${l.recruiterEmail}`,className:"text-primary hover:underline truncate text-sm flex items-center gap-2",children:[t.jsx(me,{width:16,height:16,className:"fill-current text-accent flex-shrink-0"}),t.jsx("span",{className:"line-clamp-2",children:l.recruiterEmail})]}),l.recruiterPhone&&t.jsxs("a",{href:`tel:${l.recruiterPhone.replace(/\D/g,"")}`,className:"text-primary hover:underline truncate text-sm flex items-center gap-2",children:[t.jsx(fe,{width:16,height:16,className:"fill-current text-accent flex-shrink-0"}),t.jsx("span",{className:"line-clamp-2",children:l.recruiterPhone})]})]})]})});U.displayName="PprLocationCard";const W=50;function xe({locations:s,onLocationClick:d,selectedLocation:n,resetScrollSignal:S=0}){const u=e.useRef(null),m=e.useRef({}),l=e.useRef([]),v=e.useRef(null),[C,k]=e.useState(W),[R,E]=e.useState(0),b=e.useMemo(()=>s.slice(0,C),[s,C]),f=s.length>b.length,M=e.useCallback(()=>{f&&k(r=>Math.min(r+W,s.length))},[f,s.length]);e.useEffect(()=>{if(n){const r=s.findIndex(a=>a.properties.id===n.properties.id);r>=0&&r>=C&&k(Math.min(r+W,s.length))}},[n,s,C]),e.useEffect(()=>{const r=v.current;if(!r)return;const a=new IntersectionObserver(o=>{o[0].isIntersecting&&f&&M()},{threshold:.1,rootMargin:"100px"});return a.observe(r),()=>a.disconnect()},[f,M]),e.useEffect(()=>{k(W),E(0),m.current={},l.current=[]},[s]),e.useEffect(()=>{u.current&&(window.innerWidth<768?u.current.scrollLeft=0:u.current.scrollTop=0)},[S]),e.useEffect(()=>{if(n){const r=b.findIndex(a=>a.properties.id===n.properties.id);r!==-1&&E(r)}},[n,b]),e.useEffect(()=>{if(!n||!u.current)return;const r=m.current[n.properties.id];r&&requestAnimationFrame(()=>{const a=u.current;if(!(!a||!r))if(window.innerWidth<768){const o=r.offsetLeft-(a.clientWidth-r.clientWidth)/2;a.scrollTo({left:Math.max(0,o),behavior:"smooth"})}else{const o=r.offsetTop-(a.clientHeight-r.clientHeight)/2;a.scrollTo({top:Math.max(0,o),behavior:"smooth"})}})},[n,b]);const P=e.useCallback(r=>{var T;if(r.target.getAttribute("role")!=="listitem"||r.key!=="ArrowUp"&&r.key!=="ArrowDown"&&r.key!=="ArrowLeft"&&r.key!=="ArrowRight")return;r.preventDefault();const a=window.innerWidth>=768;let o=R;a?r.key==="ArrowDown"?o++:r.key==="ArrowUp"&&o--:r.key==="ArrowRight"?o++:r.key==="ArrowLeft"&&o--,o>=0&&o<b.length&&(E(o),(T=l.current[o])==null||T.focus())},[R,b.length]);return e.useEffect(()=>{const r=u.current;if(!r)return;const a=o=>{window.innerWidth<768&&o.deltaY!==0?(o.preventDefault(),r.scrollLeft+=o.deltaY):o.stopPropagation()};return r.addEventListener("wheel",a,{passive:!1}),()=>r.removeEventListener("wheel",a)},[]),t.jsxs("div",{className:"md:overflow-y-auto overflow-x-auto md:max-h-screen max-w-full h-full flex md:flex-col flex-row hide-scrollbar gap-2 md:p-4 p-2 pt-4",ref:u,onKeyDown:P,role:"list","aria-label":"PPR locations",tabIndex:-1,children:[b.map((r,a)=>t.jsx(U,{ref:o=>{m.current[r.properties.id]=o,l.current[a]=o},location:r,isSelected:(n==null?void 0:n.properties.id)===r.properties.id,onClick:d,tabIndex:a===R?0:-1,"aria-posinset":a+1,"aria-setsize":s.length},r.properties.id)),f&&t.jsxs("div",{ref:v,className:"md:w-auto w-64 flex-shrink-0 min-h-[180px] flex items-center justify-center text-sm text-gray-500 p-4",children:["Showing ",b.length," of ",s.length]})]})}const ge=320,we=400,be={longitude:-98.5795,latitude:39.8283,zoom:3.5,transitionDuration:F};function ve({geojsonUrl:s,mapboxToken:d,mapboxStyle:n,container:S}){const[u,m]=e.useState(null),[l,v]=e.useState(null),[C,k]=e.useState(be),[R,E]=e.useState({left:0,top:0,right:0,bottom:0}),[b,f]=e.useState(!0),[M,P]=e.useState(!0),[r,a]=e.useState(null),[o]=e.useState(0),[T,z]=e.useState(!1),i=e.useRef(null),p=e.useRef(null);e.useEffect(()=>{const c=()=>{const w=window.innerWidth<768;E(w?{left:0,top:0,right:0,bottom:ge}:{left:we,top:0,right:0,bottom:0})},g=()=>{i.current&&clearTimeout(i.current),i.current=setTimeout(c,150)};return c(),window.addEventListener("resize",g),()=>{window.removeEventListener("resize",g),i.current&&clearTimeout(i.current)}},[]),e.useEffect(()=>{let c=!0;const g=new AbortController,w=s||"";return(async()=>{if(!w){P(!1);return}try{P(!0),a(null);const N=await fetch(w,{signal:g.signal,headers:{Accept:"application/geo+json, application/json"}});if(!N.ok)throw new Error(`Failed to fetch: ${N.status} ${N.statusText}`);const G=await N.json();c&&(m(G),P(!1))}catch(N){c&&!g.signal.aborted&&(a(N instanceof Error?N.message:"Failed to load PPR locations"),P(!1))}})(),()=>{c=!1,g.abort()}},[s]);const h=(u==null?void 0:u.features)??[],[y,A]=e.useState(""),x=e.useMemo(()=>{const c=y.trim().toLowerCase();return c?h.filter(g=>{const w=g.properties;return[w.name,w.address,w.recruiterName,w.recruiterEmail,w.recruiterPhone].filter(Boolean).some(N=>N.toLowerCase().includes(c))}):h},[h,y]);e.useEffect(()=>{l&&!x.some(c=>c.properties.id===l.properties.id)&&v(null)},[x,l]);const j=e.useCallback(()=>z(!0),[]),L=e.useCallback(()=>z(!1),[]),B=e.useCallback(c=>{},[T]),I=e.useCallback(c=>{var g;v(c),j(),(g=p.current)==null||g.flyTo({center:[c.geometry.coordinates[0],c.geometry.coordinates[1]],zoom:_})},[j]),D=e.useCallback(()=>{L()},[L]);return r&&!M?t.jsx("div",{className:"w-full h-screen flex items-center justify-center bg-gray-50",children:t.jsxs("div",{className:"max-w-md p-8 bg-white rounded-lg shadow-lg text-center",children:[t.jsx("div",{className:"text-red-500 mb-4",children:t.jsx("svg",{className:"w-16 h-16 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),t.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Unable to Load PPR Locations"}),t.jsx("p",{className:"text-gray-600 mb-6",children:r})]})}):t.jsxs("div",{className:"w-full h-full overflow-hidden flex flex-col min-w-[340px] relative",children:[t.jsx("div",{className:"filterbar w-full flex-shrink-0 py-2 md:py-4 relative shadow-lg z-20",children:t.jsx("div",{className:"grid-container flex flex-col items-center",children:t.jsx(le,{type:"text",id:"ppr-search","aria-label":"Search PPR locations",placeholder:"Search locations by name, address, or recruiter",className:"w-full max-w-md",icon:t.jsx(ce,{className:"w-5 h-5","aria-hidden":"true"}),iconPosition:"left",value:y,onChange:c=>A(c.target.value)})})}),t.jsxs("div",{className:"relative flex-1 w-full h-0 min-h-0 overflow-hidden z-10",children:[t.jsxs("div",{className:"absolute z-10 md:top-0 md:left-0 md:bottom-0 md:w-[400px] md:h-full w-full h-[320px] bottom-0 left-0 pointer-events-auto",children:[t.jsxs("div",{className:"text-sm md:text-base font-bold mt-4 mx-4 mb-2 md:mb-0","aria-live":"polite",children:[x.length," PPR Location",x.length===1?"":"s",y.trim()&&t.jsxs("span",{className:"text-gray-500 ml-1",children:["(",h.length," total)"]})]}),t.jsx(xe,{locations:x,onLocationClick:I,selectedLocation:l,resetScrollSignal:o})]}),t.jsxs("div",{className:"absolute inset-0 z-0",children:[t.jsx(pe,{ref:p,locations:x,onBoundsChange:B,viewState:C,onMove:c=>k(c.viewState),selectedLocation:l,onLocationClick:I,padding:R,onMapLoad:()=>f(!1),onMoveEnd:D,mapboxToken:d||"",mapboxStyle:n||"mapbox://styles/mapbox/streets-v11"}),(b||M)&&t.jsxs("div",{className:"absolute inset-0 flex items-center justify-center bg-white bg-opacity-70 z-50",children:[t.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-4 border-brand-blue border-solid"}),t.jsx("span",{className:"ml-4 text-lg font-semibold text-brand-blue",children:M?"Loading PPR locations…":"Loading map…"})]})]})]})]})}const V=new CSSStyleSheet;V.replaceSync(de.replace(/:root/ug,":host"));class ye extends HTMLElement{constructor(){super();H(this,"root",null);H(this,"container",null);this.attachShadow({mode:"open",delegatesFocus:!0})}static get observedAttributes(){return["geojson-url","mapbox-token","mapbox-style"]}getProps(){return{geojsonUrl:this.getAttribute("geojson-url")||void 0,mapboxToken:this.getAttribute("mapbox-token")||void 0,mapboxStyle:this.getAttribute("mapbox-style")||void 0,container:this.container}}connectedCallback(){this.render()}disconnectedCallback(){var n;(n=this.root)==null||n.unmount(),this.root=null}attributeChangedCallback(n,S,u){S!==u&&this.root&&this.render()}render(){var n;this.shadowRoot&&((n=this.root)==null||n.unmount(),this.root=null,this.shadowRoot.adoptedStyleSheets=[V],this.shadowRoot.innerHTML="",this.container=document.createElement("div"),this.container.className="mount-point",this.shadowRoot.appendChild(this.container),this.root=ue.createRoot(this.container),this.root.render(t.jsx(e.StrictMode,{children:t.jsx(ve,{...this.getProps()})})))}}customElements.define("ppr-locations-map",ye);
